"use strict";
const fs = require("fs");
const path = require("path");
function cliPluginMain(api, options, rootOptions) {
    api.extendPackage((pkg) => {
        console.log(`[Generator] extendPackage`);
        console.dir(pkg);
        pkg.devDependencies = {
            "@bluelovers/tsconfig": "^1.0.2",
            "@types/webpack-chain": "^5.2.0",
            "terser": "3.17.0",
            "terser-webpack-plugin": "^1.2.3",
            ...pkg.devDependencies,
        };
        return pkg;
    });
    console.log(`[Generator] options`);
    console.dir(options);
    console.log(`[Generator] rootOptions`);
    console.dir(rootOptions);
    let files_not_exists = Object.entries([
        'tsconfig.json',
        '.browserslistrc',
        '.gitignore',
    ].reduce((a, file) => {
        a[file] = file;
        return a;
    }, Object.entries({
        '.gitignore': 'gitignore',
    }).reduce((a, [file, file2]) => {
        file2 = path.join('dot', file2);
        a[file] = file2;
        return a;
    }, {})))
        .reduce((a, [file, file2]) => {
        let fpath = api.resolve(file);
        let exists = fs.existsSync(fpath);
        if (!exists || options.replaceFiles) {
            let fpath2 = path.resolve(__dirname, 'files', file2);
            let exists2 = fs.existsSync(fpath2);
            if (exists2) {
                if (exists) {
                    let bak = fpath + '.bak';
                    if (fs.existsSync(bak)) {
                        if (!fs.readFileSync(fpath).equals(fs.readFileSync(bak))) {
                            console.log(`[Generator] backup ${file}`);
                            fs.unlinkSync(bak);
                            fs.copyFileSync(fpath, bak);
                        }
                        else {
                            console.log(`[Generator] skip backup ${file}`);
                        }
                    }
                    else {
                        console.log(`[Generator] backup ${file}`);
                        fs.copyFileSync(fpath, bak);
                    }
                }
                a[file] = fpath2;
            }
        }
        return a;
    }, {});
    api.onCreateComplete(() => {
        console.log(`\n`);
        console.log(`[Generator] onCreateComplete`);
        Object.entries(files_not_exists)
            .forEach(function ([file, fpath2]) {
            let fpath = api.resolve(file);
            let exists = fs.existsSync(fpath);
            if (exists) {
                console.log(`[Generator] overwrite ${file}`);
                let bak = fpath + '.bak';
                if (!fs.existsSync(bak)) {
                    fs.renameSync(fpath, bak);
                }
                fs.copyFileSync(fpath2, fpath);
            }
            else {
                console.log(`[Generator] create ${file}`);
                fs.copyFileSync(fpath2, fpath);
            }
        });
        console.log(`\n`);
    });
}
module.exports = cliPluginMain;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZ2VuZXJhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSx5QkFBMEI7QUFDMUIsNkJBQThCO0FBOEQ5QixTQUFTLGFBQWEsQ0FBQyxHQUF3QixFQUM5QyxPQUFvRSxFQUNwRSxXQUF3QztJQUd4QyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7UUFHekIsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFakIsR0FBRyxDQUFDLGVBQWUsR0FBRztZQUNyQixzQkFBc0IsRUFBRSxRQUFRO1lBQ2hDLHNCQUFzQixFQUFFLFFBQVE7WUFDaEMsUUFBUSxFQUFFLFFBQVE7WUFDbEIsdUJBQXVCLEVBQUUsUUFBUTtZQUVqQyxHQUFHLEdBQUcsQ0FBQyxlQUFlO1NBQ3RCLENBQUM7UUFFRixPQUFPLEdBQUcsQ0FBQTtJQUNYLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQ25DLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7SUFFekIsSUFBSSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQ3BDLGVBQWU7UUFDZixpQkFBaUI7UUFDakIsWUFBWTtLQUNaLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFO1FBR3BCLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUM7UUFFZixPQUFPLENBQUMsQ0FBQTtJQUNULENBQUMsRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQ2pCLFlB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QUssRUFBRSxHQUFHLENBQUMsQ0FBQztpQkFDMUI7Z0JBRUQsRUFBRSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDL0I7aUJBRUQ7Z0JBQ0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFDMUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDL0I7UUFDRixDQUFDLENBQUMsQ0FDRjtRQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkIsQ0FBQyxDQUFDLENBQUM7QUFDSixDQUFDO0FBRUQsaUJBQVMsYUFBYSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFByZXNldEpzb24gPSByZXF1aXJlKCcuL3ByZXNldC5qc29uJyk7XG5pbXBvcnQgUGFja2FnZUpzb24gPSByZXF1aXJlKCcuL3BhY2thZ2UuanNvbicpO1xuaW1wb3J0IGZzID0gcmVxdWlyZSgnZnMnKTtcbmltcG9ydCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuXG50eXBlIElQYWNrYWdlSnNvbkZpZWxkcyA9IFBhcnRpYWw8dHlwZW9mIFBhY2thZ2VKc29uPiAmIHtcblx0c2NyaXB0cz86IHtcblx0XHRbbmFtZTogc3RyaW5nXTogc3RyaW5nLFxuXHR9LFxuXHRkZXBlbmRlbmNpZXM/OiB7XG5cdFx0W25hbWU6IHN0cmluZ106IHN0cmluZyxcblx0fSxcblx0ZGV2RGVwZW5kZW5jaWVzPzoge1xuXHRcdFtuYW1lOiBzdHJpbmddOiBzdHJpbmcsXG5cdH0sXG5cdHJlc29sdXRpb25zPzoge1xuXHRcdFtuYW1lOiBzdHJpbmddOiBzdHJpbmcsXG5cdH0sXG5cblx0W2tleTogc3RyaW5nXTogdW5rbm93bixcbn1cblxuaW50ZXJmYWNlIElWdWVDbGlHZW5lcmF0b3JBcGlcbntcblx0ZXh0ZW5kUGFja2FnZTxUIGV4dGVuZHMge1xuXHRcdFtrOiBzdHJpbmddOiB1bmtub3duLFxuXHR9PihmaWVsZHM6IFQgJiBJUGFja2FnZUpzb25GaWVsZHMgfCAoKHBrZzogVCAmIElQYWNrYWdlSnNvbkZpZWxkcykgPT4gVCAmIElQYWNrYWdlSnNvbkZpZWxkcykpOiB2b2lkXG5cblx0cmVzb2x2ZShfcGF0aDogc3RyaW5nKTogc3RyaW5nLFxuXG5cdGhhc1BsdWdpbihpZDogc3RyaW5nKTogYm9vbGVhbixcblxuXHRvbkNyZWF0ZUNvbXBsZXRlKGNiOiAoKSA9PiBhbnkpOiB2b2lkXG59XG5cbmludGVyZmFjZSBJVnVlQ2xpR2VuZXJhdG9yT3B0aW9uc1xue1xuXHRfaXNQcmVzZXQ/OiBib29sZWFuLFxuXHRwcm9tcHRzPzogYm9vbGVhbixcblxuXHRbazogc3RyaW5nXTogdW5rbm93bixcbn1cblxudHlwZSBJVnVlQ2xpR2VuZXJhdG9yUm9vdE9wdGlvbnMgPSB0eXBlb2YgUHJlc2V0SnNvbiAmIHtcblx0cHJvamVjdE5hbWU6IHN0cmluZyxcblx0dXNlQ29uZmlnRmlsZXM6IGJvb2xlYW4sXG5cdHBsdWdpbnM6IHtcblx0XHRbazogc3RyaW5nXToge1xuXHRcdFx0W2s6IHN0cmluZ106IHVua25vd24sXG5cdFx0fVxuXHR9LFxuXHRyb3V0ZXI6IGJvb2xlYW4sXG5cdHJvdXRlckhpc3RvcnlNb2RlOiBib29sZWFuLFxuXHR2dWV4OiBib29sZWFuLFxuXHRjc3NQcmVwcm9jZXNzb3I6ICdkYXJ0LXNhc3MnIHwgJ25vZGUtc2FzcycgfCBzdHJpbmcsXG5cdGJhcmU6IHVua25vd24sXG5cblx0W2s6IHN0cmluZ106IHVua25vd24sXG59XG5cbmludGVyZmFjZSBJVnVlQ2xpR2VuZXJhdG9yT3B0aW9uc1RoaXNQbHVnaW5cbntcblx0cmVwbGFjZUZpbGVzOiBib29sZWFuLFxufVxuXG5mdW5jdGlvbiBjbGlQbHVnaW5NYWluKGFwaTogSVZ1ZUNsaUdlbmVyYXRvckFwaSxcblx0b3B0aW9uczogSVZ1ZUNsaUdlbmVyYXRvck9wdGlvbnMgJiBJVnVlQ2xpR2VuZXJhdG9yT3B0aW9uc1RoaXNQbHVnaW4sXG5cdHJvb3RPcHRpb25zOiBJVnVlQ2xpR2VuZXJhdG9yUm9vdE9wdGlvbnMsXG4pOiB2b2lkXG57XG5cdGFwaS5leHRlbmRQYWNrYWdlKChwa2cpID0+XG5cdHtcblxuXHRcdGNvbnNvbGUubG9nKGBbR2VuZXJhdG9yXSBleHRlbmRQYWNrYWdlYCk7XG5cdFx0Y29uc29sZS5kaXIocGtnKTtcblxuXHRcdHBrZy5kZXZEZXBlbmRlbmNpZXMgPSB7XG5cdFx0XHRcIkBibHVlbG92ZXJzL3RzY29uZmlnXCI6IFwiXjEuMC4yXCIsXG5cdFx0XHRcIkB0eXBlcy93ZWJwYWNrLWNoYWluXCI6IFwiXjUuMi4wXCIsXG5cdFx0XHRcInRlcnNlclwiOiBcIjMuMTcuMFwiLFxuXHRcdFx0XCJ0ZXJzZXItd2VicGFjay1wbHVnaW5cIjogXCJeMS4yLjNcIixcblxuXHRcdFx0Li4ucGtnLmRldkRlcGVuZGVuY2llcyxcblx0XHR9O1xuXG5cdFx0cmV0dXJuIHBrZ1xuXHR9KTtcblxuXHRjb25zb2xlLmxvZyhgW0dlbmVyYXRvcl0gb3B0aW9uc2ApO1xuXHRjb25zb2xlLmRpcihvcHRpb25zKTtcblxuXHRjb25zb2xlLmxvZyhgW0dlbmVyYXRvcl0gcm9vdE9wdGlvbnNgKTtcblx0Y29uc29sZS5kaXIocm9vdE9wdGlvbnMpO1xuXG5cdGxldCBmaWxlc19ub3RfZXhpc3RzID0gT2JqZWN0LmVudHJpZXMoW1xuXHRcdFx0J3RzY29uZmlnLmpzb24nLFxuXHRcdFx0Jy5icm93c2Vyc2xpc3RyYycsXG5cdFx0XHQnLmdpdGlnbm9yZScsXG5cdFx0XS5yZWR1Y2UoKGEsIGZpbGUpID0+XG5cdFx0e1xuXG5cdFx0XHRhW2ZpbGVdID0gZmlsZTtcblxuXHRcdFx0cmV0dXJuIGFcblx0XHR9LCBPYmplY3QuZW50cmllcyh7XG5cdFx0XHQnLmdpdGlnbm9yZSc6ICdnaXRpZ25vcmUnLFxuXHRcdH0pLnJlZHVjZSgoYSwgW2ZpbGUsIGZpbGUyXSkgPT5cblx0XHR7XG5cblx0XHRcdGZpbGUyID0gcGF0aC5qb2luKCdkb3QnLCBmaWxlMik7XG5cdFx0XHRhW2ZpbGVdID0gZmlsZTJcblxuXHRcdFx0cmV0dXJuIGE7XG5cdFx0fSwge30gYXMge1xuXHRcdFx0W2ZpbGU6IHN0cmluZ106IHN0cmluZyxcblx0XHR9KSkpXG5cdFx0LnJlZHVjZSgoYSwgW2ZpbGUsIGZpbGUyXSkgPT5cblx0XHR7XG5cblx0XHRcdGxldCBmcGF0aCA9IGFwaS5yZXNvbHZlKGZpbGUpO1xuXHRcdFx0bGV0IGV4aXN0cyA9IGZzLmV4aXN0c1N5bmMoZnBhdGgpO1xuXG5cdFx0XHRpZiAoIWV4aXN0cyB8fCBvcHRpb25zLnJlcGxhY2VGaWxlcylcblx0XHRcdHtcblx0XHRcdFx0bGV0IGZwYXRoMiA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdmaWxlcycsIGZpbGUyKTtcblx0XHRcdFx0bGV0IGV4aXN0czIgPSBmcy5leGlzdHNTeW5jKGZwYXRoMik7XG5cblx0XHRcdFx0aWYgKGV4aXN0czIpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRpZiAoZXhpc3RzKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdGxldCBiYWsgPSBmcGF0aCArICcuYmFrJztcblxuXHRcdFx0XHRcdFx0aWYgKGZzLmV4aXN0c1N5bmMoYmFrKSlcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0aWYgKCFmcy5yZWFkRmlsZVN5bmMoZnBhdGgpLmVxdWFscyhmcy5yZWFkRmlsZVN5bmMoYmFrKSkpXG5cdFx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhgW0dlbmVyYXRvcl0gYmFja3VwICR7ZmlsZX1gKTtcblxuXHRcdFx0XHRcdFx0XHRcdGZzLnVubGlua1N5bmMoYmFrKTtcblx0XHRcdFx0XHRcdFx0XHRmcy5jb3B5RmlsZVN5bmMoZnBhdGgsIGJhayk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coYFtHZW5lcmF0b3JdIHNraXAgYmFja3VwICR7ZmlsZX1gKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhgW0dlbmVyYXRvcl0gYmFja3VwICR7ZmlsZX1gKTtcblx0XHRcdFx0XHRcdFx0ZnMuY29weUZpbGVTeW5jKGZwYXRoLCBiYWspO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGFbZmlsZV0gPSBmcGF0aDI7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGFcblx0XHR9LCB7fSBhcyB7XG5cdFx0XHRbZmlsZTogc3RyaW5nXTogc3RyaW5nLFxuXHRcdH0pXG5cdDtcblxuXHRhcGkub25DcmVhdGVDb21wbGV0ZSgoKSA9PlxuXHR7XG5cdFx0Y29uc29sZS5sb2coYFxcbmApO1xuXG5cdFx0Y29uc29sZS5sb2coYFtHZW5lcmF0b3JdIG9uQ3JlYXRlQ29tcGxldGVgKTtcblxuXHRcdE9iamVjdC5lbnRyaWVzKGZpbGVzX25vdF9leGlzdHMpXG5cdFx0XHQuZm9yRWFjaChmdW5jdGlvbiAoW2ZpbGUsIGZwYXRoMl0pXG5cdFx0XHR7XG5cdFx0XHRcdGxldCBmcGF0aCA9IGFwaS5yZXNvbHZlKGZpbGUpO1xuXHRcdFx0XHRsZXQgZXhpc3RzID0gZnMuZXhpc3RzU3luYyhmcGF0aCk7XG5cblx0XHRcdFx0aWYgKGV4aXN0cylcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGBbR2VuZXJhdG9yXSBvdmVyd3JpdGUgJHtmaWxlfWApO1xuXG5cdFx0XHRcdFx0bGV0IGJhayA9IGZwYXRoICsgJy5iYWsnO1xuXG5cdFx0XHRcdFx0aWYgKCFmcy5leGlzdHNTeW5jKGJhaykpXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0ZnMucmVuYW1lU3luYyhmcGF0aCwgYmFrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRmcy5jb3B5RmlsZVN5bmMoZnBhdGgyLCBmcGF0aCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coYFtHZW5lcmF0b3JdIGNyZWF0ZSAke2ZpbGV9YCk7XG5cdFx0XHRcdFx0ZnMuY29weUZpbGVTeW5jKGZwYXRoMiwgZnBhdGgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdDtcblxuXHRcdGNvbnNvbGUubG9nKGBcXG5gKTtcblx0fSk7XG59XG5cbmV4cG9ydCA9IGNsaVBsdWdpbk1haW5cbiJdfQ==