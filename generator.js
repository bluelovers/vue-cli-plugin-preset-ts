"use strict";
const fs = require("fs");
const path = require("path");
function cliPluginMain(api, options, rootOptions) {
    api.extendPackage((pkg) => {
        console.log(`[Generator] extendPackage`);
        console.dir(pkg);
        pkg.devDependencies = {
            "@bluelovers/tsconfig": "^1.0.2",
            "@types/webpack-chain": "^5.2.0",
            "terser": "3.17.0",
            "terser-webpack-plugin": "^1.2.3",
            ...pkg.devDependencies,
        };
        return pkg;
    });
    console.log(`[Generator] options`);
    console.dir(options);
    console.log(`[Generator] rootOptions`);
    console.dir(rootOptions);
    let files_not_exists = Object.entries([
        'tsconfig.json',
        '.browserslistrc',
    ].reduce((a, file) => {
        a[file] = file;
        return a;
    }, Object.entries({
        '.gitignore': 'gitignore',
        '.nvmrc': 'nvmrc',
        'public/nojekyll': 'nojekyll',
    }).reduce((a, [file, file2]) => {
        file2 = path.join('dot', file2);
        a[file] = file2;
        return a;
    }, {
        'public/_headers': '_headers',
    })))
        .reduce((a, [file, file2]) => {
        let fpath = api.resolve(file);
        let exists = fs.existsSync(fpath);
        if (!exists || options.replaceFiles) {
            let fpath2 = path.resolve(__dirname, 'files', file2);
            let exists2 = fs.existsSync(fpath2);
            if (exists2) {
                if (exists) {
                    let bak = fpath + '.bak';
                    if (fs.existsSync(bak)) {
                        if (!fs.readFileSync(fpath).equals(fs.readFileSync(bak))) {
                            console.log(`[Generator] backup ${file}`);
                            fs.unlinkSync(bak);
                            fs.copyFileSync(fpath, bak);
                        }
                        else {
                            console.log(`[Generator] skip backup ${file}`);
                        }
                    }
                    else {
                        console.log(`[Generator] backup ${file}`);
                        fs.copyFileSync(fpath, bak);
                    }
                }
                a[file] = fpath2;
            }
        }
        return a;
    }, {});
    api.onCreateComplete(() => {
        console.log(`\n`);
        console.log(`[Generator] onCreateComplete`);
        Object.entries(files_not_exists)
            .forEach(function ([file, fpath2]) {
            let fpath = api.resolve(file);
            let exists = fs.existsSync(fpath);
            if (exists) {
                console.log(`[Generator] overwrite ${file}`);
                let bak = fpath + '.bak';
                if (!fs.existsSync(bak)) {
                    fs.renameSync(fpath, bak);
                }
                fs.copyFileSync(fpath2, fpath);
            }
            else {
                console.log(`[Generator] create ${file}`);
                fs.copyFileSync(fpath2, fpath);
            }
        });
        console.log(`\n`);
    });
}
module.exports = cliPluginMain;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZ2VuZXJhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSx5QkFBMEI7QUFDMUIsNkJBQThCO0FBOEQ5QixTQUFTLGFBQWEsQ0FBQyxHQUF3QixFQUM5QyxPQUFvRSxFQUNwRSxXQUF3QztJQUd4QyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7UUFHekIsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFakIsR0FBRyxDQUFDLGVBQWUsR0FBRztZQUNyQixzQkFBc0IsRUFBRSxRQUFRO1lBQ2hDLHNCQUFzQixFQUFFLFFBQVE7WUFDaEMsUUFBUSxFQUFFLFFBQVE7WUFDbEIsdUJBQXVCLEVBQUUsUUFBUTtZQUVqQyxHQUFHLEdBQUcsQ0FBQyxlQUFlO1NBQ3RCLENBQUM7UUFFRixPQUFPLEdBQUcsQ0FBQTtJQUNYLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQ25DLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7SUFFekIsSUFBSSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQ3BDLGVBQWU7UUFDZixpQkFBaUI7S0FDakIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUU7UUFFcEIsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQztRQUVmLE9BQU8sQ0FBQyxDQUFBO0lBQ1QsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUM7UUFDakIsWUFBWSxFQUFFLFdB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QUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFDdkI7b0JBQ0MsRUFBRSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7aUJBQzFCO2dCQUVELEVBQUUsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQy9CO2lCQUVEO2dCQUNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLElBQUksRUFBRSxDQUFDLENBQUM7Z0JBQzFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQy9CO1FBQ0YsQ0FBQyxDQUFDLENBQ0Y7UUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25CLENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELGlCQUFTLGFBQWEsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcmVzZXRKc29uID0gcmVxdWlyZSgnLi9wcmVzZXQuanNvbicpO1xuaW1wb3J0IFBhY2thZ2VKc29uID0gcmVxdWlyZSgnLi9wYWNrYWdlLmpzb24nKTtcbmltcG9ydCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG5pbXBvcnQgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcblxudHlwZSBJUGFja2FnZUpzb25GaWVsZHMgPSBQYXJ0aWFsPHR5cGVvZiBQYWNrYWdlSnNvbj4gJiB7XG5cdHNjcmlwdHM/OiB7XG5cdFx0W25hbWU6IHN0cmluZ106IHN0cmluZyxcblx0fSxcblx0ZGVwZW5kZW5jaWVzPzoge1xuXHRcdFtuYW1lOiBzdHJpbmddOiBzdHJpbmcsXG5cdH0sXG5cdGRldkRlcGVuZGVuY2llcz86IHtcblx0XHRbbmFtZTogc3RyaW5nXTogc3RyaW5nLFxuXHR9LFxuXHRyZXNvbHV0aW9ucz86IHtcblx0XHRbbmFtZTogc3RyaW5nXTogc3RyaW5nLFxuXHR9LFxuXG5cdFtrZXk6IHN0cmluZ106IHVua25vd24sXG59XG5cbmludGVyZmFjZSBJVnVlQ2xpR2VuZXJhdG9yQXBpXG57XG5cdGV4dGVuZFBhY2thZ2U8VCBleHRlbmRzIHtcblx0XHRbazogc3RyaW5nXTogdW5rbm93bixcblx0fT4oZmllbGRzOiBUICYgSVBhY2thZ2VKc29uRmllbGRzIHwgKChwa2c6IFQgJiBJUGFja2FnZUpzb25GaWVsZHMpID0+IFQgJiBJUGFja2FnZUpzb25GaWVsZHMpKTogdm9pZFxuXG5cdHJlc29sdmUoX3BhdGg6IHN0cmluZyk6IHN0cmluZyxcblxuXHRoYXNQbHVnaW4oaWQ6IHN0cmluZyk6IGJvb2xlYW4sXG5cblx0b25DcmVhdGVDb21wbGV0ZShjYjogKCkgPT4gYW55KTogdm9pZFxufVxuXG5pbnRlcmZhY2UgSVZ1ZUNsaUdlbmVyYXRvck9wdGlvbnNcbntcblx0X2lzUHJlc2V0PzogYm9vbGVhbixcblx0cHJvbXB0cz86IGJvb2xlYW4sXG5cblx0W2s6IHN0cmluZ106IHVua25vd24sXG59XG5cbnR5cGUgSVZ1ZUNsaUdlbmVyYXRvclJvb3RPcHRpb25zID0gdHlwZW9mIFByZXNldEpzb24gJiB7XG5cdHByb2plY3ROYW1lOiBzdHJpbmcsXG5cdHVzZUNvbmZpZ0ZpbGVzOiBib29sZWFuLFxuXHRwbHVnaW5zOiB7XG5cdFx0W2s6IHN0cmluZ106IHtcblx0XHRcdFtrOiBzdHJpbmddOiB1bmtub3duLFxuXHRcdH1cblx0fSxcblx0cm91dGVyOiBib29sZWFuLFxuXHRyb3V0ZXJIaXN0b3J5TW9kZTogYm9vbGVhbixcblx0dnVleDogYm9vbGVhbixcblx0Y3NzUHJlcHJvY2Vzc29yOiAnZGFydC1zYXNzJyB8ICdub2RlLXNhc3MnIHwgc3RyaW5nLFxuXHRiYXJlOiB1bmtub3duLFxuXG5cdFtrOiBzdHJpbmddOiB1bmtub3duLFxufVxuXG5pbnRlcmZhY2UgSVZ1ZUNsaUdlbmVyYXRvck9wdGlvbnNUaGlzUGx1Z2luXG57XG5cdHJlcGxhY2VGaWxlczogYm9vbGVhbixcbn1cblxuZnVuY3Rpb24gY2xpUGx1Z2luTWFpbihhcGk6IElWdWVDbGlHZW5lcmF0b3JBcGksXG5cdG9wdGlvbnM6IElWdWVDbGlHZW5lcmF0b3JPcHRpb25zICYgSVZ1ZUNsaUdlbmVyYXRvck9wdGlvbnNUaGlzUGx1Z2luLFxuXHRyb290T3B0aW9uczogSVZ1ZUNsaUdlbmVyYXRvclJvb3RPcHRpb25zLFxuKTogdm9pZFxue1xuXHRhcGkuZXh0ZW5kUGFja2FnZSgocGtnKSA9PlxuXHR7XG5cblx0XHRjb25zb2xlLmxvZyhgW0dlbmVyYXRvcl0gZXh0ZW5kUGFja2FnZWApO1xuXHRcdGNvbnNvbGUuZGlyKHBrZyk7XG5cblx0XHRwa2cuZGV2RGVwZW5kZW5jaWVzID0ge1xuXHRcdFx0XCJAYmx1ZWxvdmVycy90c2NvbmZpZ1wiOiBcIl4xLjAuMlwiLFxuXHRcdFx0XCJAdHlwZXMvd2VicGFjay1jaGFpblwiOiBcIl41LjIuMFwiLFxuXHRcdFx0XCJ0ZXJzZXJcIjogXCIzLjE3LjBcIixcblx0XHRcdFwidGVyc2VyLXdlYnBhY2stcGx1Z2luXCI6IFwiXjEuMi4zXCIsXG5cblx0XHRcdC4uLnBrZy5kZXZEZXBlbmRlbmNpZXMsXG5cdFx0fTtcblxuXHRcdHJldHVybiBwa2dcblx0fSk7XG5cblx0Y29uc29sZS5sb2coYFtHZW5lcmF0b3JdIG9wdGlvbnNgKTtcblx0Y29uc29sZS5kaXIob3B0aW9ucyk7XG5cblx0Y29uc29sZS5sb2coYFtHZW5lcmF0b3JdIHJvb3RPcHRpb25zYCk7XG5cdGNvbnNvbGUuZGlyKHJvb3RPcHRpb25zKTtcblxuXHRsZXQgZmlsZXNfbm90X2V4aXN0cyA9IE9iamVjdC5lbnRyaWVzKFtcblx0XHRcdCd0c2NvbmZpZy5qc29uJyxcblx0XHRcdCcuYnJvd3NlcnNsaXN0cmMnLFxuXHRcdF0ucmVkdWNlKChhLCBmaWxlKSA9PlxuXHRcdHtcblx0XHRcdGFbZmlsZV0gPSBmaWxlO1xuXG5cdFx0XHRyZXR1cm4gYVxuXHRcdH0sIE9iamVjdC5lbnRyaWVzKHtcblx0XHRcdCcuZ2l0aWdub3JlJzogJ2dpdGlnbm9yZScsXG5cdFx0XHQnLm52bXJjJzogJ252bXJjJyxcblx0XHRcdCdwdWJsaWMvbm9qZWt5bGwnOiAnbm9qZWt5bGwnLFxuXHRcdH0pLnJlZHVjZSgoYSwgW2ZpbGUsIGZpbGUyXSkgPT5cblx0XHR7XG5cblx0XHRcdGZpbGUyID0gcGF0aC5qb2luKCdkb3QnLCBmaWxlMik7XG5cdFx0XHRhW2ZpbGVdID0gZmlsZTI7XG5cblx0XHRcdHJldHVybiBhO1xuXHRcdH0sIHtcblx0XHRcdCdwdWJsaWMvX2hlYWRlcnMnOiAnX2hlYWRlcnMnLFxuXHRcdH0gYXMge1xuXHRcdFx0W2ZpbGU6IHN0cmluZ106IHN0cmluZyxcblx0XHR9KSkpXG5cdFx0LnJlZHVjZSgoYSwgW2ZpbGUsIGZpbGUyXSkgPT5cblx0XHR7XG5cblx0XHRcdGxldCBmcGF0aCA9IGFwaS5yZXNvbHZlKGZpbGUpO1xuXHRcdFx0bGV0IGV4aXN0cyA9IGZzLmV4aXN0c1N5bmMoZnBhdGgpO1xuXG5cdFx0XHRpZiAoIWV4aXN0cyB8fCBvcHRpb25zLnJlcGxhY2VGaWxlcylcblx0XHRcdHtcblx0XHRcdFx0bGV0IGZwYXRoMiA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdmaWxlcycsIGZpbGUyKTtcblx0XHRcdFx0bGV0IGV4aXN0czIgPSBmcy5leGlzdHNTeW5jKGZwYXRoMik7XG5cblx0XHRcdFx0aWYgKGV4aXN0czIpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRpZiAoZXhpc3RzKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdGxldCBiYWsgPSBmcGF0aCArICcuYmFrJztcblxuXHRcdFx0XHRcdFx0aWYgKGZzLmV4aXN0c1N5bmMoYmFrKSlcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0aWYgKCFmcy5yZWFkRmlsZVN5bmMoZnBhdGgpLmVxdWFscyhmcy5yZWFkRmlsZVN5bmMoYmFrKSkpXG5cdFx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhgW0dlbmVyYXRvcl0gYmFja3VwICR7ZmlsZX1gKTtcblxuXHRcdFx0XHRcdFx0XHRcdGZzLnVubGlua1N5bmMoYmFrKTtcblx0XHRcdFx0XHRcdFx0XHRmcy5jb3B5RmlsZVN5bmMoZnBhdGgsIGJhayk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coYFtHZW5lcmF0b3JdIHNraXAgYmFja3VwICR7ZmlsZX1gKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhgW0dlbmVyYXRvcl0gYmFja3VwICR7ZmlsZX1gKTtcblx0XHRcdFx0XHRcdFx0ZnMuY29weUZpbGVTeW5jKGZwYXRoLCBiYWspO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGFbZmlsZV0gPSBmcGF0aDI7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGFcblx0XHR9LCB7fSBhcyB7XG5cdFx0XHRbZmlsZTogc3RyaW5nXTogc3RyaW5nLFxuXHRcdH0pXG5cdDtcblxuXHRhcGkub25DcmVhdGVDb21wbGV0ZSgoKSA9PlxuXHR7XG5cdFx0Y29uc29sZS5sb2coYFxcbmApO1xuXG5cdFx0Y29uc29sZS5sb2coYFtHZW5lcmF0b3JdIG9uQ3JlYXRlQ29tcGxldGVgKTtcblxuXHRcdE9iamVjdC5lbnRyaWVzKGZpbGVzX25vdF9leGlzdHMpXG5cdFx0XHQuZm9yRWFjaChmdW5jdGlvbiAoW2ZpbGUsIGZwYXRoMl0pXG5cdFx0XHR7XG5cdFx0XHRcdGxldCBmcGF0aCA9IGFwaS5yZXNvbHZlKGZpbGUpO1xuXHRcdFx0XHRsZXQgZXhpc3RzID0gZnMuZXhpc3RzU3luYyhmcGF0aCk7XG5cblx0XHRcdFx0aWYgKGV4aXN0cylcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGBbR2VuZXJhdG9yXSBvdmVyd3JpdGUgJHtmaWxlfWApO1xuXG5cdFx0XHRcdFx0bGV0IGJhayA9IGZwYXRoICsgJy5iYWsnO1xuXG5cdFx0XHRcdFx0aWYgKCFmcy5leGlzdHNTeW5jKGJhaykpXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0ZnMucmVuYW1lU3luYyhmcGF0aCwgYmFrKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRmcy5jb3B5RmlsZVN5bmMoZnBhdGgyLCBmcGF0aCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coYFtHZW5lcmF0b3JdIGNyZWF0ZSAke2ZpbGV9YCk7XG5cdFx0XHRcdFx0ZnMuY29weUZpbGVTeW5jKGZwYXRoMiwgZnBhdGgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdDtcblxuXHRcdGNvbnNvbGUubG9nKGBcXG5gKTtcblx0fSk7XG59XG5cbmV4cG9ydCA9IGNsaVBsdWdpbk1haW5cbiJdfQ==